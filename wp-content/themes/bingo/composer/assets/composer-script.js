var BINGO_RUBY_COMPOSER=function(e,t){"use strict";return{init:function(){var e=this;if(e.loader(),"gutenberg"==e.$isGutenberg)var o=setInterval(function(){e.$editor=t("#editor"),e.$editor.length>0&&(clearInterval(o),e.initComposerGutenberg())},50);else e.classicSwitchMode(),e.classicChangeTemplateAtts(),e.setupSectionPanel(),e.initSections(),e.unloadChecker()},loader:function(){this.$composerWrapper=t("#bingo_ruby_composer_editor"),this.$isGutenberg=bingo_ruby_is_gutenberg,this.$composerData=bingo_ruby_page_composer_data,this.$composerTemplate=bingo_ruby_composer_template,this.$setupBlocks=bingo_ruby_setup_blocks,this.$setupSections=bingo_ruby_setup_sections,this.$unload=!1,this.$hmltEditorID={}},classicSwitchMode:function(){var e=t("#bingo_ruby_switch_mode"),o=t("#page_template");e.length>0&&e.on("click",function(e){e.preventDefault(),e.stopPropagation(),o.val("page-composer.php"),o.trigger("change"),t(this).remove()})},classicChangeTemplateAtts:function(){var e=this,o=t("#page_template");o.change(function(){"page-composer.php"==o.val()?(e.$composerWrapper.show(),t("#bingo_ruby_metabox_composer_options").show(),t("#bingo_ruby_page_options").hide(),t("#bingo_ruby_metabox_single_page_options").hide(),t("#bingo_ruby_metabox_sidebar_options").hide(),t("#bingo_ruby_metabox_box_comment_options").hide(),t("#postdivrich").hide()):(e.$composerWrapper.hide(),t("#bingo_ruby_metabox_composer_options").hide(),t("#postdivrich").show(),t("#bingo_ruby_page_options").show(),t("#bingo_ruby_metabox_single_page_options").show(),t("#bingo_ruby_metabox_sidebar_options").show(),t("#bingo_ruby_metabox_box_comment_options").show())}).triggerHandler("change")},setupSectionPanel:function(){var e=this,o=t("#bingo_ruby_section_select");t.each(e.$setupSections,function(e,i){var a=t('<div class="section-select-el"><a href="#"></a></div>');i.img&&(a=t('<div class="section-select-el"><a href="#"><img alt="'+e+'" src="'+i.img+'"></a></div>')),a.find("a").data("section_type",e).append("<span>"+i.title+"</span>"),o.append(a)}),o.find("a").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.addNewSection(this)}),o.on("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).slideToggle(200)})},addNewSection:function(e){var o=this;o.$unload=!0;var i=t(e).data("section_type"),a=o.loadSection(i,{});o.scrollToSection(a)},initSections:function(){var e=this,t=e.$composerWrapper.find(".ruby-sections-wrap");e.renderSections(),t.sortable({handle:".ruby-section-bar",placeholder:"ruby-highlight",forcePlaceholderSize:!0,update:function(){e.$unload=!0,"classic"==e.$isGutenberg&&(e.reloadHTMLEditor(),t.sortable("refresh"))}})},renderSections:function(){var e=this;"object"==typeof e.$composerData&&t.each(e.$composerData,function(t,o){e.loadSection(o.section_type,o)}),e.$composerWrapper.find(".ruby-composer-loading").fadeTo(400,0,function(){t(this).remove()})},loadSection:function(e,o){if(this.$composerTemplate[e]){var i,a=this,r="bingo_ruby_section_"+(i=void 0===o.section_id?a.uuid():o.section_id),s=t(a.$composerTemplate[e]);if("section_has_sidebar"==e){var p="bingo_ruby_sidebar_"+i,c="bingo_ruby_meta_sidebar_position_"+i,n="bingo_ruby_meta_sidebar_sticky_"+i,l="bingo_ruby_sidebar_default";void 0!==o.section_sidebar&&(l=o.section_sidebar),s.find(".ruby-section-sidebar").html(a.$composerTemplate.input.sidebar),s.find(".ruby-sidebar-position").attr("name",c),s.find(".ruby-sidebar-sticky").attr("name",n),s.find(".ruby-sidebar-select").attr("name",p).val(l),void 0!==o.section_sidebar_position&&s.find(".ruby-sidebar-position").val(o.section_sidebar_position),void 0!==o.section_sidebar_sticky&&s.find(".ruby-sidebar-sticky").val(o.section_sidebar_sticky)}s.find(".ruby-section-type").attr("name",r).val(e),s.find(".ruby-section-order").val(i),s.find(".ruby-section-label").html(a.$setupSections[e].title);var m=a.$composerWrapper.find(".ruby-sections-wrap");return m.find(".ruby-section-empty").remove(),m.append(s),a.sectionUserBtn(s),s.section_type=e,a.initComposerBlocks(s,o),s}},sectionUserBtn:function(e){var t=this;e.find(".ruby-section-bar, .ruby-section-open-option").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.sectionExplainToggle(this)}),e.find(".ruby-section-delete").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.deleteSection(this)})},sectionExplainToggle:function(e){t(e).parents(".ruby-section").find(".ruby-block-wrap").slideToggle(200)},deleteSection:function(e){confirm(this.$composerTemplate.confirm_section_delete)&&(this.$unload=!0,t(e).parents(".ruby-section").fadeOut(300,function(){t(this).remove()}),t(document).trigger("rubyComposerDelete"))},scrollToSection:function(e){void 0!=e&&("gutenberg"==this.$isGutenberg?t(".edit-post-layout__content").animate({scrollTop:e.offset().top},300):t("html,body").animate({scrollTop:e.offset().top},300))},initComposerBlocks:function(e,t){var o=this;o.setupComposerBlocks(e);var i=e.find(".ruby-block");o.renderBlocks(e,t),i.sortable({handle:".ruby-block-bar",placeholder:"ruby-highlight",forcePlaceholderSize:!0,update:function(){o.$unload=!0,"classic"==o.$isGutenberg&&(o.reloadHTMLEditor(),i.sortable("refresh"))}})},setupComposerBlocks:function(e){var o=this,i=e.find(".block-select-wrap");t.each(o.$setupBlocks,function(o,a){if(a.section===e.section_type){var r=t('<div class="block-select-el"><a href="#"></a></div>');a.img&&(r=t('<div class="block-select-el"><a href="#"><img alt="'+o+'" src="'+a.img+'"></a></div>')),r.find("a").data("block_name",o).append("<span>"+a.title+"</span>"),i.append(r)}}),i.find("a").on("click",function(e){e.preventDefault(),e.stopPropagation(),o.addNewBlock(this)}),e.find(".add-block-select").on("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).next(".block-select-wrap").slideToggle(200)})},renderBlocks:function(e,o){var i=this;"object"==typeof o&&"object"==typeof o.blocks&&t.each(o.blocks,function(t,o){void 0!==o.block_name&&i.loadBlock(o.block_name,e.find(".ruby-block-wrap"),o)}),e.find(".ruby-composer-loading").fadeTo(400,0,function(){t(this).remove()})},addNewBlock:function(e){this.$unload=!0;var o=t(e),i=o.data("block_name"),a=o.parents(".ruby-block-wrap"),r=this.loadBlock(i,a,{});this.scrollToBlock(r)},loadBlock:function(e,o,i){var a,r=this,s="bingo_ruby_block_"+(a=i.block_id?i.block_id:r.uuid()),p=r.$setupBlocks[e].title,c=r.$setupBlocks[e].description,n=o.find(".ruby-section-order").val(),l=t(r.$composerTemplate.block),m=o.find(".ruby-block");return l.find(".ruby-block-name").attr("name",s).val(e),l.find(".ruby-block-order").attr("name","bingo_ruby_block_order["+n+"][]").val(a),l.find(".ruby-block-description").html(c),l.find(".ruby-block-label").html(p),void 0===i.block_options&&(i.block_options={}),void 0!==i.block_options.title&&""!=i.block_options.title&&l.find(".ruby-block-label").html(p+" : "+i.block_options.title),r.loadBlockOptions(l,e,i.block_options),m.append(l),o.find(".ruby-section-empty").remove(),r.blockUserBtn(l),l},blockUserBtn:function(e){var t=this;e.find(".ruby-block-bar, .ruby-block-open-option").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.toggleBlockSetting(this)}),e.find(".ruby-block-delete").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.deleteBlock(this)})},toggleBlockSetting:function(e){var o=t(e).parents(".ruby-block-item").find(".ruby-block-options-wrap");o&&o.slideToggle(200)},deleteBlock:function(e){this.$unload=!0,t(e).parents(".ruby-block-item").fadeOut(400,function(){t(this).remove()}),t(document).trigger("rubyComposerDelete")},scrollToBlock:function(e){void 0!==e&&(t("html,body").animate({scrollTop:e.offset().top},300),setTimeout(function(){e.find(".ruby-block-open-option").trigger("click")},300))},loadBlockOptions:function(e,o,i){var a=this;if(a.$setupBlocks[o]){var r=a.$setupBlocks[o],s=!0;if(r.block_options){var p=e.find(".ruby-block-name").attr("name");return e.find(".ruby-block-options-wrap").removeClass("hidden"),t.each(r.block_options,function(o,r){"object"==typeof r&&(a.addTabFilter(e,o,s),s=!1,t.each(r,function(r,s){var c,n,l,m=t(a.$composerTemplate.block_option);switch(r){case"title":c=a.$composerTemplate.title.title,l=a.$composerTemplate.desc.title,n=a.$composerTemplate.input.text;break;case"title_url":c=a.$composerTemplate.title.title_url,l=a.$composerTemplate.desc.title_url,n=a.$composerTemplate.input.text;break;case"category_id":c=a.$composerTemplate.title.category_id,l=a.$composerTemplate.desc.category_id,n=a.$composerTemplate.input.category;break;case"category_ids":c=a.$composerTemplate.title.category_ids,l=a.$composerTemplate.desc.category_ids,n=a.$composerTemplate.input.categories;break;case"post_format":c=a.$composerTemplate.title.post_format,l=a.$composerTemplate.desc.post_format,n=a.$composerTemplate.input.post_format;break;case"tags":c=a.$composerTemplate.title.tags,l=a.$composerTemplate.desc.tags,n=a.$composerTemplate.input.text;break;case"post_id":c=a.$composerTemplate.title.post_id,l=a.$composerTemplate.desc.post_id,n=a.$composerTemplate.input.text;break;case"authors":c=a.$composerTemplate.title.authors,l=a.$composerTemplate.desc.authors,n=a.$composerTemplate.input.authors;break;case"posts_per_page":c=a.$composerTemplate.title.posts_per_page,l=a.$composerTemplate.desc.posts_per_page,n=a.$composerTemplate.input.posts_per_page;break;case"slides_per_page":c=a.$composerTemplate.title.slides_per_page,l=a.$composerTemplate.desc.slides_per_page,n=a.$composerTemplate.input.posts_per_page;break;case"offset":c=a.$composerTemplate.title.offset,l=a.$composerTemplate.desc.offset,n=a.$composerTemplate.input.num;break;case"orderby":c=a.$composerTemplate.title.orderby,l=a.$composerTemplate.desc.orderby,n=a.$composerTemplate.input.orderby;break;case"excerpt":c=a.$composerTemplate.title.excerpt,l=a.$composerTemplate.desc.excerpt,n=a.$composerTemplate.input.num;break;case"excerpt_classic":c=a.$composerTemplate.title.excerpt_classic,l=a.$composerTemplate.desc.excerpt_classic,n=a.$composerTemplate.input.num;break;case"readmore":c=a.$composerTemplate.title.readmore,l=a.$composerTemplate.desc.readmore,n=a.$composerTemplate.input.enable;break;case"image_url":c=a.$composerTemplate.title.image_url,l=a.$composerTemplate.desc.image_url,n=a.$composerTemplate.input.text;break;case"description":c=a.$composerTemplate.title.description,l=a.$composerTemplate.desc.description,n=a.$composerTemplate.input.textarea;break;case"button_title":c=a.$composerTemplate.title.button_title,l=a.$composerTemplate.desc.button_title,n=a.$composerTemplate.input.text;break;case"pagination":c=a.$composerTemplate.title.pagination,l=a.$composerTemplate.desc.pagination;var d=a.$composerTemplate.input.pagination;d=t.parseHTML(d),t.each(s,function(e,o){0==o&&t(d).find("option[value="+e+"]").remove()}),n=t(d)[0].outerHTML;break;case"wrap_mode":c=a.$composerTemplate.title.wrap_mode,l=a.$composerTemplate.desc.wrap_mode,n=a.$composerTemplate.input.wrap_mode;break;case"big_first":c=a.$composerTemplate.title.big_first,l=a.$composerTemplate.desc.big_first,n=a.$composerTemplate.input.enable;break;case"color":c=a.$composerTemplate.title.color,l=a.$composerTemplate.desc.color,n=a.$composerTemplate.input.color;break;case"ad_title":c=a.$composerTemplate.title.ad_title,l=a.$composerTemplate.desc.ad_title,n=a.$composerTemplate.input.text;break;case"ad_image":c=a.$composerTemplate.title.ad_image,l=a.$composerTemplate.desc.ad_image,n=a.$composerTemplate.input.text;break;case"ad_url":c=a.$composerTemplate.title.ad_url,l=a.$composerTemplate.desc.ad_url,n=a.$composerTemplate.input.text;break;case"ad_script":c=a.$composerTemplate.title.ad_script,l=a.$composerTemplate.desc.ad_script,n=a.$composerTemplate.input.textarea;break;case"ajax_dropdown":c=a.$composerTemplate.title.ajax_dropdown,l=a.$composerTemplate.desc.ajax_dropdown,n=a.$composerTemplate.input.ajax_dropdown;break;case"ajax_dropdown_id":c=a.$composerTemplate.title.ajax_dropdown_id,l=a.$composerTemplate.desc.ajax_dropdown_id,n=a.$composerTemplate.input.text;break;case"ajax_dropdown_text":c=a.$composerTemplate.title.ajax_dropdown_text,l=a.$composerTemplate.desc.ajax_dropdown_text,n=a.$composerTemplate.input.text;break;case"viewmore":c=a.$composerTemplate.title.viewmore,l=a.$composerTemplate.desc.viewmore,n=a.$composerTemplate.input.viewmore;break;case"viewmore_text":c=a.$composerTemplate.title.viewmore_text,l=a.$composerTemplate.desc.viewmore_text,n=a.$composerTemplate.input.text;break;case"viewmore_link":c=a.$composerTemplate.title.viewmore_link,l=a.$composerTemplate.desc.viewmore_link,n=a.$composerTemplate.input.text;break;case"summary_type":c=a.$composerTemplate.title.summary_type,l=a.$composerTemplate.desc.summary_type,n=a.$composerTemplate.input.summary_type;break;case"position":c=a.$composerTemplate.title.position,l=a.$composerTemplate.desc.position,n=a.$composerTemplate.input.position;break;case"thumb_position":c=a.$composerTemplate.title.thumb_position,l=a.$composerTemplate.desc.thumb_position,n=a.$composerTemplate.input.position;break;case"block_style":c=a.$composerTemplate.title.block_style,l=a.$composerTemplate.desc.block_style,n=a.$composerTemplate.input.block_style;break;case"auto_play":c=a.$composerTemplate.title.auto_play,l=a.$composerTemplate.desc.auto_play,n=a.$composerTemplate.input.enable;break;case"grid_style":c=a.$composerTemplate.title.grid_style,l=a.$composerTemplate.desc.grid_style,n=a.$composerTemplate.input.grid_style;break;case"background":c=a.$composerTemplate.title.background,l=a.$composerTemplate.desc.background,n=a.$composerTemplate.input.text;break;case"background_image":c=a.$composerTemplate.title.background_image,l=a.$composerTemplate.desc.background_image,n=a.$composerTemplate.input.text;break;case"header_color":c=a.$composerTemplate.title.header_color,l=a.$composerTemplate.desc.header_color,n=a.$composerTemplate.input.text;break;case"text_style":c=a.$composerTemplate.title.text_style,l=a.$composerTemplate.desc.text_style,n=a.$composerTemplate.input.text_style;break;case"shortcode":c=a.$composerTemplate.title.shortcode,l=a.$composerTemplate.desc.shortcode,n=a.$composerTemplate.input.text;break;case"share":c=a.$composerTemplate.title.share,l=a.$composerTemplate.desc.share,n=a.$composerTemplate.input.share;break;case"meta_info":c=a.$composerTemplate.title.meta_info,l=a.$composerTemplate.desc.meta_info,n=a.$composerTemplate.input.meta_info;break;case"cat_info":c=a.$composerTemplate.title.cat_info,l=a.$composerTemplate.desc.cat_info,n=a.$composerTemplate.input.cat_info;break;case"custom_html":c=a.$composerTemplate.title.custom_html,l=a.$composerTemplate.desc.custom_html,n=a.$composerTemplate.input.custom_html;break;default:c="",l="",n=""}switch(n=t(n),r){case"category_ids":n.attr("name","bingo_ruby_block_option["+p+"]["+r+"][]");break;case"custom_html":n.attr("id","html-"+p),n.attr("name","bingo_ruby_block_option["+p+"]["+r+"]");break;default:n.attr("name","bingo_ruby_block_option["+p+"]["+r+"]")}"boolean"!=typeof s&&"object"!=typeof s&&"array"!=typeof s&&n.val(s),void 0!==i&&void 0!==i[r]&&n.val(i[r]),m.find(".ruby-block-option-label").append(c),m.find(".ruby-block-option-description").append(l),m.find(".ruby-block-option-inner").append(n),e.find(".ruby-tab-"+o).append(m)}))}),a.tabFilterToggle(e),"classic"==a.$isGutenberg&&a.loadHTMLEditor(e),e}}},addTabFilter:function(e,t,o){var i='<a href="#" class="ruby-tab-filter-el" data-filter="ruby-tab-'+t+'">'+t+"</a>";1==o&&(i='<a href="#" class="ruby-tab-filter-el filter-active" data-filter="ruby-tab-'+t+'">'+t+"</a>");var a='<div class="ruby-tab ruby-tab-'+t+'"></div>';e.find(".ruby-filter-link").append(i),e.find(".ruby-block-content").append(a)},tabFilterToggle:function(e){e.find(".ruby-tab-filter-el").on("click",function(o){o.preventDefault(),o.stopPropagation();var i=t(this),a=i.data("filter");i.parent().find("a").removeClass("filter-active"),i.addClass("filter-active"),e.find(".ruby-tab").hide(),e.find("."+a).show()})},loadHTMLEditor:function(e){var o=e.find(".ruby-raw-html");if(o.length){var i={},a={};i.id=o.attr("id"),this.$hmltEditorID[i.id]=i.id,i.content=o.val(),i.name=o.attr("name"),(a=tinyMCEPreInit.mceInit.content).selector=i.id;var r=o.parent(".ruby-block-option-inner").addClass("is-fullwidth");r.append('<div class="ruby-composer-loading"></div>'),t.ajax({type:"POST",dataType:"json",url:composer_params.ajaxurl,data:{action:"composer_load_tinymce",data:i},success:function(e){r.html(e),tinyMCE.init(a),tinymce.execCommand("mceAddEditor",!1,i.id),quicktags({id:i.id}),t(document).trigger("rubyComposerEditorLoad")}})}},reloadHTMLEditor:function(){this.$hmltEditorID&&t.each(this.$hmltEditorID,function(e,t){try{tinyMCE.execCommand("mceRemoveEditor",!1,t),tinyMCE.execCommand("mceAddEditor",!1,t)}catch(e){}})},uuid:function(){return"ruby_"+"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},unloadChecker:function(){var e=this;t("body").find("#publishing-action, .editor-post-save-draft, .editor-post-publish-panel__toggle").on("click",function(){e.$unload=!1}),t(".ruby-field").on("input",function(){e.$unload=!0}),t(window).on("beforeunload",function(){if(!0===e.$unload)return e.$unload=!1,e.$composerTemplate.unload})},initComposerGutenberg:function(){var e=this;e.$currentTemplateData=wp.data.select("core/editor").getEditedPostAttribute("template"),e.gutenbergAddPanel(),t.isEmptyObject(e.$composerData)&&"page-composer.php"!=e.$currentTemplateData?e.gutenbergSwitchMode():(e.gutenbergInitData(),e.gutenbergShowComposer()),setTimeout(function(){e.setupSectionPanel(),e.initSections()},1),wp.data.subscribe(function(){e.gutenbergSaveComposer(),e.gutenbergChangeTemplateAttr()})},gutenbergAddPanel:function(){var e=wp.template("bingo-composer-panel");this.$composerWrapper.length<1&&(this.$editor.find(".editor-block-list__layout, .editor-post-text-editor").after(e),this.$composerWrapper=t("#bingo_ruby_composer_editor"))},gutenbergSwitchMode:function(){var e=this,o=wp.template("bingo-composer-switch-btn");e.$editor.find(".edit-post-header-toolbar").append(o),e.$editor.find("#bingo_ruby_switch_mode").on("click",function(o){o.preventDefault(),o.stopPropagation(),e.gutenbergShowComposer(),e.gutenbergInitData(),t(this).remove()})},gutenbergShowComposer:function(){this.$editor.find(".editor-block-list__layout, .editor-post-text-editor").addClass("is-hidden"),this.$editor.find(".edit-post-text-editor").addClass("is-maxwidth"),this.$editor.find(".ruby-composer-editor").removeClass("is-hidden")},gutenbergHideComposer:function(){this.$editor.find(".editor-block-list__layout, .editor-post-text-editor").removeClass("is-hidden"),this.$editor.find(".edit-post-text-editor").removeClass("is-maxwidth"),this.$editor.find(".ruby-composer-editor").addClass("is-hidden")},gutenbergChangeTemplateAttr:function(){var e=this,o=t(".editor-page-attributes__template select");o.length&&o.change(function(){"page-composer.php"==o.val()?(e.gutenbergShowComposer(),e.gutenbergInitData(),e.$editor.find("#bingo_ruby_switch_mode").remove()):e.gutenbergHideComposer()})},gutenbergInitData:function(){wp.data.select("core/editor").getEditedPostAttribute("title")||wp.data.dispatch("core/editor").editPost({title:"Ruby Composer Daft #"+t("#post_ID").val()}),wp.data.dispatch("core/editor").editPost({template:"page-composer.php"})},gutenbergSaveComposer:function(){if(!wp.data.select("core/editor").isAutosavingPost()&&wp.data.select("core/editor").isSavingPost()){var e=wp.data.select("core/editor").getCurrentPost();if(!e.id||!e.type||!e.status)return;var o="action=composer_save_page";o+="&post_ID="+e.id,o+="&post_type="+e.type,this.$composerWrapper.find(".ruby-section-order, .ruby-section-type, .ruby-block-order, .ruby-block-name, .ruby-field, .ruby-sidebar-sticky, .ruby-sidebar-select, .ruby-sidebar-position").each(function(){o+="&"+t(this).serialize()}),t.ajax({type:"POST",async:!0,dataType:"json",url:composer_params.ajaxurl,data:o,success:function(e){}})}}}}(0,jQuery);jQuery(document).ready(function(){BINGO_RUBY_COMPOSER.init()});